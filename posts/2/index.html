
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cansada de ser feliz</title>
  <meta name="author" content="vero4ka">

  
  <meta name="description" content="Tpaga es una plataforma que permite recibir pagos electrónicos. Tiene una estructura sencilla para entender y fácil para usar. Para obtener nuestros &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.vero4ka.info/posts/2/">

  <link href="/favicon.ico" rel="icon">

  <!--Fonts from Google's Web font directory -->
  <link href="https://fonts.googleapis.com/css?family=Cherry+Swash" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">

  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Cansada de ser feliz" type="application/atom+xml">

  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43471959-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Cansada de ser feliz</a></h1>
  
    <h2>Bienvenidos a mi flujo de conciencia</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.vero4ka.info">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/comments">Contacts</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/18/como-hacer-integracion-con-tpaga-api-usando-python/">Cómo hacer integración con Tpaga API usando Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-08-18T08:53:45-05:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:53 am</span></time>
        
           | <a href="/blog/2016/08/18/como-hacer-integracion-con-tpaga-api-usando-python/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/08/18/como-hacer-integracion-con-tpaga-api-usando-python/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://tpaga.co/">Tpaga</a> es una plataforma que permite recibir pagos electrónicos. Tiene una estructura sencilla para entender y fácil para usar.</p>

<p>Para obtener nuestros claves de acceso y conectarnos con el API de Tpaga, creamos una cuenta en el &ldquo;sandbox&rdquo; de la plataforma: <a href="https://sandbox.tpaga.co/">sandbox.tpaga.co</a>.</p>

<p><img src="/images/tpaga_sandbox_login.png"></p>

<p>Al registrarnos podemos ver que ahora tenemos dos claves que podemos usar para la autenticación: <strong>Private Api Key</strong> y <strong>Public Api Key</strong>:</p>

<p><img src="/images/tpaga_sandbox_dashboard.png"></p>

<p>Tpaga tiene unos modelos básicos que nos permitirán organizar nuestros datos: <strong>Customers</strong> (Clientes), <strong>Credit Cards</strong> (Tarjetas de crédito) asociados a los Clientes y <strong>Charges</strong> (Transacciónes o cobros por tarjeta de crédito).</p>

<p>Ahora, cuando entendemos la estructura, podemos empezar a escribir nuestro programa en Python. Primero instalamos la librería <code>requests</code> que nos permitirá hacer peticiones HTTP.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install requests
</span></code></pre></td></tr></table></div></figure>


<p>Tpaga, como muchos otros sitios web, acepta la autenticación mediante HTTP Basic Auth. La librería <code>requests</code> provee una forma fácil de usarla:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">TPAGA_PRIVATE_TOKEN</span> <span class="o">=</span> <span class="s">&#39;d13fr8n7vhvkuch3lq2ds5qhjnd2pdd2&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">tpaga_url</span> <span class="o">=</span> <span class="s">&#39;https://sandbox.tpaga.co/api/customer&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">tpaga_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{},</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">TPAGA_PRIVATE_TOKEN</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">Response</span> <span class="p">[</span><span class="mi">201</span><span class="p">]</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Escribimos un código sencillo que nos permitirá conectarse al API de Tpaga y mandar peticiones:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">urlparse</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'>
</span><span class='line'><span class="n">TPAGA_PRIVATE_TOKEN</span> <span class="o">=</span> <span class="s">&#39;d13fr8n7vhvkuch3lq2ds5qhjnd2pdd2&#39;</span>
</span><span class='line'><span class="n">TPAGA_API_URL</span> <span class="o">=</span> <span class="s">&#39;https://sandbox.tpaga.co/api/&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TpagaTestClient</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
</span><span class='line'>            <span class="bp">self</span><span class="p">,</span>
</span><span class='line'>            <span class="n">private_token</span><span class="o">=</span><span class="n">TPAGA_PRIVATE_TOKEN</span><span class="p">,</span>
</span><span class='line'>            <span class="n">base_url</span><span class="o">=</span><span class="n">TPAGA_API_URL</span><span class="p">,</span>
</span><span class='line'>    <span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">private_token</span> <span class="o">=</span> <span class="n">private_token</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">api_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
</span><span class='line'>            <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">private_token</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span class='line'>            <span class="n">urlparse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">path</span><span class="p">),</span>
</span><span class='line'>            <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span class='line'>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;Whoops, got</span><span class="se">\n\n</span><span class="s">STATUS: {}</span><span class="se">\n\n</span><span class="s">HEADERS: {}</span><span class="se">\n\n</span><span class="s">CONTENT: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span class='line'>                <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span class='line'>                <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
</span><span class='line'>                <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
</span><span class='line'>            <span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">json_from_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">expected_http_code</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_http_code</span><span class="p">:</span>
</span><span class='line'>            <span class="n">expected_http_code</span> <span class="o">=</span> <span class="p">[</span><span class="mi">201</span><span class="p">]</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expected_http_code</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="bp">None</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>El método <code>__init__</code> nos va a inicializar nuestro cliente, <code>api_post</code> - mandar peticiones POST a la ruta especificada (<code>path</code>) del API, <code>json_from_response</code> - obtener un objeto JSON de la respuesta de API, <code>fail</code> - imprimir los detalles de la respuesta si la petición no ha terminado con éxito.</p>

<h3>Crear un cliente</h3>

<p>Para crear nuestro cliente, vamos a enviar una petición POST al endpoint <code>/customer</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TpagaTestClient</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># ...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create_customer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_post</span><span class="p">(</span><span class="s">&#39;customer&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">TpagaTestClient</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_customer</span><span class="p">({</span>
</span><span class='line'>    <span class="s">&#39;firstName&#39;</span><span class="p">:</span> <span class="s">&#39;Horns and Hoofs&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;lastName&#39;</span><span class="p">:</span> <span class="s">&#39;Perez&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;email&#39;</span><span class="p">:</span> <span class="s">&#39;hornsandhoofs@example.com&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;phone&#39;</span><span class="p">:</span> <span class="s">&#39;012345678&#39;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">customer_token</span> <span class="o">=</span> <span class="n">customer</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;customer_token&#39;</span><span class="p">,</span> <span class="n">customer_token</span><span class="p">)</span>
</span><span class='line'><span class="n">customer_token</span> <span class="n">qoodmh04sh7ghpp58opn5g0hssg4slq0</span>
</span></code></pre></td></tr></table></div></figure>


<p>Otros campos que podemos enviar para guardar nuestros clientes se puede encontrar aquí: <a href="https://tpaga.co/docs/swaggers/v2#!/Customer/createCustomer">tpaga.co/docs/swaggers/v2#!/Customer/createCustomer</a>.</p>

<p>En el dashboard de Tpaga podemos asegurarnos de que el ciente <a href="https://en.wikipedia.org/wiki/The_Little_Golden_Calf#Cultural_influence">&ldquo;Horns and Hoofs&rdquo;</a> fue creado exitosamente:</p>

<p><img src="/images/tpaga_dashboard_customers.png"></p>

<p>Teniendo un token de nuestro cliente, podemos agregarle una tarjeta de crédito.</p>

<h3>Registrar una tarjeta de crédito y asociarla al cliente</h3>

<p>La creación de la tarjeta de crédito se realiza en dos pasos: tokenizar la tarjeta y asociarla un cliente.</p>

<p>Tpaga usa <strong>tokenización</strong>, que nos permite registrar las tarjetas de crédito de nuestros clientes de forma segura. Los clientes ingresan los datos en nuestro sitio web, y estos datos los enviamos directamente al API de Tpaga (desde el código JavaScript), allí serán tokenizados y Tpaga nos devuelve un token temporal con el que podemos proceder con el registro de la tarjeta (desde el código Python).</p>

<p>Creamos un formulario HTML para obtener los datos de la tarjeta de crédito:</p>

<p><img src="/images/tpaga_credit_card_form.png"></p>

<p>Para hacer un formulario bonito, usamos <a href="http://bootsnipp.com/snippets/featured/credit-card-payment-with-stripe">la plantilla de Bootstrap</a> y las librerías <a href="https://jquery.com/">jQuery</a>, <a href="https://jqueryvalidation.org/">jQuery Validation Plugin</a> y <a href="https://github.com/stripe/jquery.payment">jQuery.payment</a> para validar los datos.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;credit_card_form&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">name=</span><span class="s">&quot;credit_card_form&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-xs-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span> <span class="na">id=</span><span class="s">&quot;div_id_primaryAccountNumber&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label requiredField&quot;</span> <span class="na">for=</span><span class="s">&quot;id_primaryAccountNumber&quot;</span><span class="nt">&gt;</span>Número de la tarjeta<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;input-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;textinput textInput form-control&quot;</span> <span class="na">id=</span><span class="s">&quot;id_primaryAccountNumber&quot;</span> <span class="na">name=</span><span class="s">&quot;primaryAccountNumber&quot;</span> <span class="na">required=</span><span class="s">&quot;&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;input-group-addon&quot;</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-credit-card&quot;</span><span class="nt">&gt;&lt;/i&gt;&lt;/span&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-xs-12&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span> <span class="na">id=</span><span class="s">&quot;div_id_cardHolderName&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label requiredField&quot;</span> <span class="na">for=</span><span class="s">&quot;id_cardHolderName&quot;</span><span class="nt">&gt;</span>Nombre del tarjetahabiente<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;textinput textInput form-control&quot;</span> <span class="na">id=</span><span class="s">&quot;id_cardHolderName&quot;</span> <span class="na">name=</span><span class="s">&quot;cardHolderName&quot;</span> <span class="na">required=</span><span class="s">&quot;&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-xs-3&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span> <span class="na">id=</span><span class="s">&quot;div_id_expirationMonth&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label requiredField&quot;</span> <span class="na">for=</span><span class="s">&quot;id_expirationMonth&quot;</span><span class="nt">&gt;</span>Fecha de expiración<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">&quot;select form-control&quot;</span> <span class="na">id=</span><span class="s">&quot;id_expirationMonth&quot;</span> <span class="na">name=</span><span class="s">&quot;expirationMonth&quot;</span> <span class="na">required=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;01&quot;</span><span class="nt">&gt;</span>Enero<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;02&quot;</span><span class="nt">&gt;</span>Febrero<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;03&quot;</span><span class="nt">&gt;</span>Marzo<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;04&quot;</span><span class="nt">&gt;</span>Abril<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;05&quot;</span><span class="nt">&gt;</span>Mayo<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;06&quot;</span><span class="nt">&gt;</span>Junio<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;07&quot;</span><span class="nt">&gt;</span>Julio<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;08&quot;</span><span class="nt">&gt;</span>Agosto<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;09&quot;</span><span class="nt">&gt;</span>Septiembre<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;</span>Octubre<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;11&quot;</span><span class="nt">&gt;</span>Noviembre<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;12&quot;</span><span class="nt">&gt;</span>Diciembre<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/select&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-xs-3&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span> <span class="na">id=</span><span class="s">&quot;div_id_expirationYear&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label requiredField&quot;</span> <span class="na">for=</span><span class="s">&quot;id_expirationYear&quot;</span><span class="nt">&gt;</span>Año<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">&quot;select form-control&quot;</span> <span class="na">id=</span><span class="s">&quot;id_expirationYear&quot;</span> <span class="na">name=</span><span class="s">&quot;expirationYear&quot;</span> <span class="na">required=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2016&quot;</span><span class="nt">&gt;</span>2016<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2017&quot;</span><span class="nt">&gt;</span>2017<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2018&quot;</span><span class="nt">&gt;</span>2018<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2019&quot;</span><span class="nt">&gt;</span>2019<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2020&quot;</span><span class="nt">&gt;</span>2020<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2021&quot;</span><span class="nt">&gt;</span>2021<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2022&quot;</span><span class="nt">&gt;</span>2022<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2023&quot;</span><span class="nt">&gt;</span>2023<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2024&quot;</span><span class="nt">&gt;</span>2024<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>              <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;2025&quot;</span><span class="nt">&gt;</span>2025<span class="nt">&lt;/option&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/select&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-xs-3 pull-right&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;form-group&quot;</span> <span class="na">id=</span><span class="s">&quot;div_id_cvc&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label requiredField&quot;</span> <span class="na">for=</span><span class="s">&quot;id_cvc&quot;</span><span class="nt">&gt;</span>CVC<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;textinput textInput form-control&quot;</span> <span class="na">id=</span><span class="s">&quot;id_cvc&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;10&quot;</span> <span class="na">name=</span><span class="s">&quot;cvc&quot;</span> <span class="na">required=</span><span class="s">&quot;&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;buttonHolder&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary bg-purple&quot;</span> <span class="na">id=</span><span class="s">&quot;submit-id-submit&quot;</span> <span class="na">name=</span><span class="s">&quot;submit&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Guardar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Al final, tenemos un formulario con los siguientes campos:</p>

<ul>
<li><code>primaryAccountNumber</code> para el número de la tarjeta,</li>
<li><code>cardHolderName</code> para el nombre del tarjetahabiente,</li>
<li><code>expirationMonth</code> para el mes de expiración,</li>
<li><code>expirationYear</code> para el año de expiración,</li>
<li><code>cvc</code> para el código CVC.</li>
</ul>


<p>Creamos otro formulario oculto que usaremos para enviar el token temporal de la tarjeta de crédito a nuestro servidor:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;associate_customer_cc_form&quot;</span> <span class="na">action=</span><span class="s">&quot;/asociar-cliente-tarjeta-credito&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;tmp_cc_token&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>En el código JavaScript obtenemos los datos de la tarjeta de crédito y los enviamos al endpoint de Tpaga <code>tokenize/credit_card</code>. Este endpoint convierte los datos sensibles de la tarjeta en un token, el cual será empleado para ejecutar el procesamiento de las transacciones sin necesidad que los datos sensibles del tarjetahabiente pasen por nuestro servidor. Si la información de la tarjeta tiene errores, Tpaga nos devuelve un JSON con el nombre de campo y el mensaje de error, y en el caso contrario - token temporal de la tarjeta.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">serializeObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">serializeArray</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nx">o</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">o</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">]];</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="nx">o</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">o</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">associate_customer_cc</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">text_status</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[name=&quot;tmp_cc_token&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// Enviar el token temporal a nuestro servidor</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#associate_customer_cc_form&#39;</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">show_errors</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">text_status</span><span class="p">,</span> <span class="nx">error_thrown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Mostrar errores de validación</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.payment-errors&#39;</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.row&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.payment-errors&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Error de autenticación a la plataforma de pagos.&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">422</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.payment-errors&#39;</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.row&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
</span><span class='line'>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.payment-errors&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Datos erróneos en el campo &#39;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form label[for=&quot;id_&#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">field</span> <span class="o">+</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">()));</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">tokenize_credit_card</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.payment-errors&#39;</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.row&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.payment-errors&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">tpaga_public_key</span> <span class="o">=</span> <span class="s1">&#39;pk_test_qvbvuthlvqpijnr0elmtg5jh&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Enviar los datos de la tarjeta directamente a Tpaga y obtener el token temporal</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;https://sandbox.tpaga.co/api/tokenize/credit_card&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;Basic &#39;</span> <span class="o">+</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">tpaga_public_key</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">username</span><span class="o">:</span> <span class="nx">tpaga_public_key</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">serializeObject</span><span class="p">()),</span>
</span><span class='line'>      <span class="nx">contentType</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">success</span><span class="o">:</span> <span class="nx">associate_customer_cc</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">error</span><span class="o">:</span> <span class="nx">show_errors</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#credit_card_form&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">tokenize_credit_card</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>donde <code>tpaga_public_key</code> es <strong>la llave PÚBLICA</strong> que copiamos desde el dashboard de Tpaga.</p>

<p>Ahora usando el token temporal de la tarjeta (<code>tmp_cc_token</code>) podemos asociarla al cliente:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TpagaTestClient</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># ...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">assoc_cc_to_customer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_token</span><span class="p">,</span> <span class="n">cc_temp_token</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="n">cdata</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;token&#39;</span><span class="p">:</span> <span class="n">cc_temp_token</span> <span class="p">}</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_post</span><span class="p">(</span>
</span><span class='line'>            <span class="s">&#39;customer/{}/credit_card_token&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">customer_token</span><span class="p">),</span> <span class="n">cdata</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;</span> <span class="n">cc_temp_token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;tmp_cc_token&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">credit_card</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">assoc_cc_to_customer</span><span class="p">(</span>
</span><span class='line'>    <span class="n">customer_token</span><span class="o">=</span><span class="n">customer_token</span><span class="p">,</span>
</span><span class='line'>    <span class="n">cc_temp_token</span><span class="o">=</span><span class="n">cc_temp_token</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">credit_card_token</span> <span class="o">=</span> <span class="n">credit_card</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&#39;credit_card_token&#39;</span><span class="p">,</span> <span class="n">credit_card_token</span><span class="p">)</span>
</span><span class='line'><span class="n">credit_card_token</span> <span class="mi">2</span><span class="n">k54foql0hki0ot7avrg9nhpvbpqam55</span>
</span></code></pre></td></tr></table></div></figure>


<p>Mirando la tabla de <a href="https://sandbox.tpaga.co/merchantDashboard/cards">sandbox.tpaga.co/merchantDashboard/cards</a> vemos que nuestra tarjeta quedó registrada con Tpaga.</p>

<h3>Realizar el pago por la tarjeta de crédito</h3>

<p>Con el token de la tarjeta de crédito, que obtuvimos en el paso anterior, ahora podemos realizar pagos. Para eso enviemos una petición POST al <a href="https://tpaga.co/docs/swaggers/v2#!/Charge/addCreditCardCharge">addCreditCardCharge</a> endpoint con los siguientes parametros:</p>

<ul>
<li><code>orderId</code> - nuestro id interno que asociamos al pago, que luego nos ayudaría a identificar la transacción en el dashboard de Tpaga;</li>
<li><code>amount</code>- cantidad de dinero para cobrar,</li>
<li><code>currency</code>- tipo de moneda, por ejemplo, &lsquo;COP&rsquo;,</li>
<li><code>creditCard</code> - token de la tarjeta de crédito.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">TpagaTestClient</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># ...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">charge_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_token</span><span class="p">,</span> <span class="n">order_id</span><span class="o">=</span><span class="s">&#39;BRG-2&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span><span class='line'>        <span class="n">cdata</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>              <span class="s">&#39;orderId&#39;</span><span class="p">:</span> <span class="n">order_id</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;currency&#39;</span><span class="p">:</span> <span class="s">&#39;COP&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;taxAmount&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;One bridge in good condition.&#39;</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;installments&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
</span><span class='line'>              <span class="s">&#39;creditCard&#39;</span><span class="p">:</span> <span class="n">cc_token</span><span class="p">,</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_post</span><span class="p">(</span><span class="s">&#39;charge/credit_card&#39;</span><span class="p">,</span> <span class="n">cdata</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">refund_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_charge_id</span><span class="p">):</span>
</span><span class='line'>        <span class="n">cdata</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">cc_charge_id</span><span class="p">,</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_post</span><span class="p">(</span><span class="s">&#39;refund/credit_card&#39;</span><span class="p">,</span> <span class="n">cdata</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">expected_http_code</span><span class="o">=</span><span class="p">[</span><span class="mi">202</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;</span> <span class="n">charge_cc_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">charge_cc</span><span class="p">(</span><span class="n">cc_token</span><span class="o">=</span><span class="n">credit_card_token</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">4500</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">cc_charge_id</span> <span class="o">=</span> <span class="n">charge_cc_response</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&#39;charge_cc_response&#39;</span><span class="p">,</span> <span class="n">charge_cc_response</span><span class="p">)</span>
</span><span class='line'><span class="n">charge_cc_response</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="s">&#39;1rnfu463258eph0mlqli4105mjb85kut&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;creditCard&#39;</span><span class="p">:</span> <span class="s">&#39;ifmjd9rbe8peqdjh09pln702306nfniu&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;thirdPartyId&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;installments&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;tpagaFeeAmount&#39;</span><span class="p">:</span> <span class="s">&#39;868.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;customer&#39;</span><span class="p">:</span> <span class="s">&#39;gl01l74skk0po9afrjiaaclt0hr5acsh&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;iacAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;transactionInfo&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;authorizationCode&#39;</span><span class="p">:</span> <span class="s">&#39;723045&#39;</span><span class="p">,</span>  <span class="c"># código de transacción del banco</span>
</span><span class='line'>        <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;authorized&#39;</span><span class="p">,</span>  <span class="c"># Posibles valores: created, fraudulent, </span>
</span><span class='line'>                                 <span class="c"># settled, processor_declined, authorized,</span>
</span><span class='line'>                                 <span class="c"># voided</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s">&#39;netAmount&#39;</span><span class="p">:</span> <span class="s">&#39;3545.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;tipAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;reteIvaAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;reteIcaAmount&#39;</span><span class="p">:</span> <span class="s">&#39;19.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;paid&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;reteRentaAmount&#39;</span><span class="p">:</span> <span class="s">&#39;68.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;paymentTransaction&#39;</span><span class="p">:</span> <span class="s">&#39;tta2hlk0e5n5dgr4kggm5j6vv8qoh3jP&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;orderId&#39;</span><span class="p">:</span> <span class="s">&#39;BRG-2&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;One bridge in good condition.&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;currency&#39;</span><span class="p">:</span> <span class="s">&#39;COP&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;errorMessage&#39;</span><span class="p">:</span> <span class="s">&#39;Approved&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;taxAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;errorCode&#39;</span><span class="p">:</span> <span class="s">&#39;00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;amount&#39;</span><span class="p">:</span> <span class="s">&#39;4500.00&#39;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si el pago fue exitoso, el código de respuesta es <code>201</code> y en el JSON podemos ver que la llave <code>paid</code> es <code>True</code> y <code>amount</code> es igual al valor cobrado de la tarjeta.</p>

<p>En el caso cuando el código de respuesta es <code>402</code>, tendríamos fijarnos en los valores de <code>errorCode</code> y <code>errorMessage</code> para entender qué pasó con la transacción. Por ejemplo, el código de error <code>43</code> significa que el dueño de la tarjeta la reportó como robada, y <code>61</code> - que el monto máximo de tarjeta fue excedido.</p>

<p>En otros casos necesitaremos verificar que los datos que pasamos en la petición sean válidos y tengan todos los valores necesarios.</p>

<h3>Revertir el pago</h3>

<p>Los bancos nos permiten revertir el pago dentro de 24 horas después de la transacción. Para hacerlo debemos mandar token de la transacción que queremos revertir al <a href="https://tpaga.co/docs/swaggers/v2#!/Credit_Card/refundCreditCardCharge">refundCreditCardCharge</a> endpoint.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;</span> <span class="n">refund_cc_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">refund_cc</span><span class="p">(</span><span class="n">cc_charge_id</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;refund_cc_response&#39;</span><span class="p">,</span> <span class="n">refund_cc_response</span><span class="p">)</span>
</span><span class='line'><span class="n">refund_cc_response</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="s">&#39;1rnfu463258eph0mlqli4105mjb85kut&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;creditCard&#39;</span><span class="p">:</span> <span class="s">&#39;ifmjd9rbe8peqdjh09pln702306nfniu&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;thirdPartyId&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;installments&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;tpagaFeeAmount&#39;</span><span class="p">:</span> <span class="s">&#39;868.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;customer&#39;</span><span class="p">:</span> <span class="s">&#39;gl01l74skk0po9afrjiaaclt0hr5acsh&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;iacAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;transactionInfo&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;authorizationCode&#39;</span><span class="p">:</span> <span class="s">&#39;723045&#39;</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;voided&#39;</span><span class="p">},</span>
</span><span class='line'>    <span class="s">&#39;netAmount&#39;</span><span class="p">:</span> <span class="s">&#39;3545.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;tipAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;reteIvaAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;reteIcaAmount&#39;</span><span class="p">:</span> <span class="s">&#39;19.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;paid&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;reteRentaAmount&#39;</span><span class="p">:</span> <span class="s">&#39;68.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;paymentTransaction&#39;</span><span class="p">:</span> <span class="s">&#39;tta2hlk0e5n5dgr4kggm5j6vv8qoh3jP&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;orderId&#39;</span><span class="p">:</span> <span class="s">&#39;BRG-2&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;One bridge in good condition.&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;currency&#39;</span><span class="p">:</span> <span class="s">&#39;COP&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;errorMessage&#39;</span><span class="p">:</span> <span class="s">&#39;Approved&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;taxAmount&#39;</span><span class="p">:</span> <span class="s">&#39;0.00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;errorCode&#39;</span><span class="p">:</span> <span class="s">&#39;00&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&#39;amount&#39;</span><span class="p">:</span> <span class="s">&#39;4500.00&#39;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>El JSON que nos devolvió Tpaga <code>transactionInfo.status</code> aparece como <code>voided</code> y el valor de <code>paid</code> ahora es falso:</p>

<p><img src="/images/tpaga_dashboard_refund.png"></p>

<p>Enlaces:</p>

<ul>
<li>Documentación de Tpaga: <a href="https://tpaga.co/docs/swaggers/v2">tpaga.co/docs/swaggers/v2</a></li>
<li>Tpaga FAQ: <a href="https://tpaga.zendesk.com/hc/es">tpaga.zendesk.com/hc/es</a></li>
<li>Documentación para la librería <a href="http://docs.python-requests.org/en/master/">Requests: HTTP for Humans</a></li>
<li>Un ejemplo de integración con Tpaga usando PHP/JavaScript: <a href="https://github.com/Tpaga/tpaga-php-example-backend/">Tpaga/tpaga-php-example-backend</a></li>
</ul>


<p>Muchas gracias a <a href="https://twitter.com/jerojasro">@jerojasro</a> por su ayuda y paciencia.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/30/el-colegio/">El colegio</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-30T18:40:16-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:40 pm</span></time>
        
           | <a href="/blog/2016/07/30/el-colegio/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/07/30/el-colegio/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Nunca me gustaba ir al colegio y siempre he contado cuánto falta hasta el
último día de encarcelamiento.</p>

<p>Entré al colegio cuando tenía 7 años. Normalmente los niños entran un año
antes, pero a mis 6 me dijeron que la niña era demasiado pequeña. Durante
12 meses no crecí mucho, pero ya que no tuvieron razones de no aceptarme.</p>

<p>Mi primer día no me gustó: habían muchos niños a quienes no conocía y no
quería conocerlos, que se movían por el salón de una forma caótica y hacían
mucho ruido. Me pusieron en la última mesa del aula junto a la ventana.
En la primera clase a profesora nos dijo que sacaramos nuestros cuadernos
de las maletas y dibujaramos algo. Eso fue un estrés total: no pude abrir
mi maleta. Como tuve que manejar la cerradura por primera vez en mi vida,
no supe cómo funcionaba y claro que el panico, que llegó inmediatamente,
no me permitió pensar con claridad.</p>

<p>Del primer grado sólo recuerdo cómo nos enseñaban caligrafía: tuvimos
que escribir las mismas letras muchas veces. Entonces al final se quedaron
varias páginas con “а”, “б”, “в”, etc.</p>

<p>En el segundo grado nos muvieron a otro edificio y empezamos a prestar
servicio. Cada grupo por turnos tuvo que estar de servicio en el colegio
durante toda la semana. Esto segnificaba que tuvimos que llegar 30 minutos
antes que todos los demás.  Nos reunían en el primer piso y decían a cada
no su cargo. Habían varios tipos de cargos: unos tuvieron que estar en
la entrada del edificio y en las entradas de cada piso y decir a cada niño
que pasaba: “¡Smenka!”. “Smenka” significa “los zapatos de cambio”.
En el invierno la nieve se metía en las indiduras de los zapatos y cuando
uno entraba al edificio se derretía y dejaba charcos. Por eso por el orden
“¡Smenka!” el estudiante tuvo que levantar el pie y mostrar la suela.
Si estaba mojada “el guardia” tuvo que detenerlo y mandarlo a la casa por
los zapatos de cambio. Ese cargo no me gustaba porque los otros estudiantes
lo tomaban como un deporte lograr pasar con los zapatos que llevaban puestos
en la calle, entonces inventaban trucos para confundir la guardia o
simplemente corrían de nosotros. Entonces había otro cargo: vigilar
los corredores, detener los estudiantes que corrían y mandarles
al director del colegio.</p>

<p>Existía un cargo que era el más agradable de todos: estar en la cafetería.
Había que ordenar las mesas y las sillas y antes de las horas del desayuno
y almuerzo había que servir la comida y después recoger los platos.</p>

<p>Después de las clases nos quedábamos por una hora para limpiar todo el colegio.</p>

<p>Tuvimos 4 periodos y 4 vacaciones: 3 cortas y umas largas de tres meses
en verano. Para las vacaciones de verano nos daban una lista de libros para
leer. Como durante los estudios casi no tuvimos tiempo para la lectura,
tuvimos que pasar por todos los libros del curso de literatura antrs de
que empezara el año escolar. A pesar de que leía de 3 a 5 horas al día no
alcanzaba leer todos los libros del listado. Me gusta leer mucho, pero
odiaba las clases de literatura. La parte más tonta era memorizar los poemas.
Tuvimos que recitar de memoria los poemas de Homero, Pushkin, Lermontov,
Tiútchev, Mayakovski, Blok y muchos otros. A cada uno llamaban a la pizarra
y tuvimos que declamar frente al grupo. Así los profesores lograron que hasta
la mejor poesía pudiera provocar un reflejo vomitivo. Pero creo que era la
mejor forma de instalar los pensamientos de otras personas a las mentes
inmaduras. Hasta ahora cuando veo una tormenta fuerte a veces se me ocurren
las estrofas de Tiútchev:</p>

<p>Люблю грозу в начале мая (Me gustan las tormentas a principios de mayo) /
Когда весенний первый гром (Cuando el primer trueno primaveral) /
Как бы резвяся и играя (Como haciendo travesuras y jugando) /
Грохочет в небе голубом (Trona en el cielo azul).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/22/monitoreo-de-acciones-de-usuarios-en-flask-sqlalchemy/">Monitoreo de acciones de usuarios en Flask (SQLAlchemy)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-22T08:23:58-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>8:23 am</span></time>
        
           | <a href="/blog/2016/07/22/monitoreo-de-acciones-de-usuarios-en-flask-sqlalchemy/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/07/22/monitoreo-de-acciones-de-usuarios-en-flask-sqlalchemy/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Suponemos que en nuestro proyecto de Flask hay un modelo <code>Client</code> definidao usando <a href="http://flask-sqlalchemy.pocoo.org/">Flask-SQLAlchemy</a> y queremos monetorear los cambios que se realizan sobre los objetos de ese modelo.</p>

<p>Para esto agregamos tres señales:</p>

<figure class='code'><figcaption><span>models.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">main.signals</span> <span class="kn">import</span> <span class="n">receive_before_update</span><span class="p">,</span> <span class="n">receive_before_insert</span><span class="p">,</span> <span class="n">receive_before_delete</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
</span><span class='line'>    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">phone</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Client</span><span class="p">,</span> <span class="s">&#39;before_insert&#39;</span><span class="p">,</span> <span class="n">receive_before_insert</span><span class="p">)</span>
</span><span class='line'><span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Client</span><span class="p">,</span> <span class="s">&#39;before_update&#39;</span><span class="p">,</span> <span class="n">receive_before_update</span><span class="p">)</span>
</span><span class='line'><span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Client</span><span class="p">,</span> <span class="s">&#39;before_delete&#39;</span><span class="p">,</span> <span class="n">receive_before_delete</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>EN el gódigo de cada señal llamamos los métodos <code>inspect()</code> y <code>get_history()</code> para detectar los cambios sobre el objeto:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">state</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">client_object</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span class='line'>     <span class="n">hist</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_history</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por ejemplo, para el atributo <code>name</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="err">&#39;added&#39;:</span> <span class="err">[&#39;Company</span> <span class="err">A&#39;],</span>
</span><span class='line'>    <span class="err">&#39;deleted&#39;:</span> <span class="err">[&#39;Company</span> <span class="err">B&#39;],</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>El mégoto <code>get_history()</code> nos devuelve un objeto <code>sqlalchemy.orm.attributes.History</code> que tiene los siguientes atributos:</p>

<ul>
<li><code>added</code> - listado de valores agregados al atributo de nuestro objeto</li>
<li><code>deleted</code> - listado de valores eliminados del atributo de nuestro objeto</li>
<li><code>unchanged</code> - listado de valores del atributo de nuestro objeto que se quedaron intactos</li>
<li><code>has_changes()</code> - método que retorna <code>True</code> si no habían ningunos cambios de valor de nuestro atributo.</li>
</ul>


<p>Ahora, usando la variable <code>current_user</code> de la biblioteca <a href="https://flask-login.readthedocs.io/">Flask-Login</a>, podemos guargar el usuario que realizó los cambios:</p>

<figure class='code'><figcaption><span>signals.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">flask_login</span> <span class="kn">import</span> <span class="n">current_user</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">save_changes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">state</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span class='line'>        <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
</span><span class='line'>            <span class="n">hist</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_history</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</span><span class='line'>            <span class="k">if</span> <span class="ow">not</span> <span class="n">hist</span><span class="o">.</span><span class="n">has_changes</span><span class="p">():</span>
</span><span class='line'>                <span class="k">continue</span>
</span><span class='line'>            <span class="n">added</span> <span class="o">=</span> <span class="n">format_changes_value</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">added</span><span class="p">)</span>
</span><span class='line'>            <span class="n">deleted</span> <span class="o">=</span> <span class="n">format_changes_value</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">deleted</span><span class="p">)</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">added</span> <span class="o">!=</span> <span class="n">deleted</span><span class="p">:</span>
</span><span class='line'>                <span class="n">changes</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>                    <span class="s">&#39;added&#39;</span><span class="p">:</span> <span class="n">added</span><span class="p">,</span>
</span><span class='line'>                    <span class="s">&#39;deleted&#39;</span><span class="p">:</span> <span class="n">deleted</span><span class="p">,</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
</span><span class='line'>            <span class="n">mongo</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">user_logs</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
</span><span class='line'>                <span class="n">current_user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span class='line'>                <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
</span><span class='line'>                <span class="n">table_name</span><span class="o">=</span><span class="n">target</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">,</span>
</span><span class='line'>                <span class="n">object_id</span><span class="o">=</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span class='line'>                <span class="n">changes</span><span class="o">=</span><span class="n">changes</span><span class="p">,</span>
</span><span class='line'>                <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
</span><span class='line'>            <span class="p">))</span>
</span><span class='line'>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>        <span class="k">pass</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">receive_before_insert</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
</span><span class='line'>    <span class="n">save_changes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">&#39;create&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">receive_before_update</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
</span><span class='line'>    <span class="n">save_changes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">&#39;update&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">receive_before_delete</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
</span><span class='line'>    <span class="n">save_changes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/22/flask-for-django-developers/">Flask for Django developers</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-22T07:35:02-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>7:35 am</span></time>
        
           | <a href="/blog/2016/07/22/flask-for-django-developers/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/07/22/flask-for-django-developers/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li>Aplicación básica</li>
<li>Blueprints</li>
<li>URLs</li>
<li>Vistas</li>
<li>Plantillas (Jinja2)</li>
<li>Procesadores de contexto</li>
<li>Modelos (SQLAlchemy, CRUD)</li>
<li>Formularios</li>
<li>Autenticación</li>
<li>Múltiples idiomas</li>
<li>Mensajes (flash)</li>
<li>Cache</li>
</ol>


<iframe src="//slides.com/vero4ka/flask-para-desarrolladorres-de-django/embed?style=light" width="576" height="420" scrolling="no" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>


<ul>
<li>Slides: <a href="http://slides.com/vero4ka/flask-para-desarrolladorres-de-django/">http://slides.com/vero4ka/flask-para-desarrolladorres-de-django/</a></li>
<li>Examples: <a href="https://github.com/vero4karu/flask-examples">https://github.com/vero4karu/flask-examples</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/07/20/las-temporadas/">Las temporadas</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-07-20T18:34:10-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:34 pm</span></time>
        
           | <a href="/blog/2016/07/20/las-temporadas/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/07/20/las-temporadas/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A veces me parece que aquí el tiempo no se mueve. A veces me digo:
“El verano pasado…” – o – “El próximo invierno”, y luego me doy cuenta
que no hay ningún verano, ni invierno, ni primavera, ni otoño. Y eso da
el sentido que no cambia nada, pero cuando uno mira atrás, así llega uno
a horrorizarse de cuánto tiempo ha pasado.</p>

<p>Pero antes todo era diferente…</p>

<p>Todo el verano sentía euforia de que por fin hacía calor y todo alrededor
estaba verde. Podía mirar por horas cómo se movían las ramas de los árboles
con el viento, aspirar el aire lleno de olores y escuchar los sonidos del bosque.
Parecía que todo el mundo estaba feliz: los niños por fin tenían sus vacaciones,
sacaban sus bicicletas y patines y salían a jugar afuera, las muchachas se
desvestían tratando de exponer más de su cuerpo al sol. Constantemente había
que acordarse de que eso se iba a acabar pronto, de que teníamos muy poco
tiempo para disfrutarlo, entonces había que aprovechar cada momento, y por eso
la gente se enloquecía.</p>

<p>En junio o julio a veces hace tanto calor que parece que el asfalto se funde.
Realmente, todo se funde. Pero en agosto la llegan los vientos del norte
trayendo las decepciones. La mente todavía no puede aceptar que el verano
se acabó tan rápido, y la mente no manda al cuerpo que tiene que vestirse.
Entonces llegamos al otoño con mocos y tos.</p>

<p>El otoño es un poco incómodo, porque uno no sabe cómo vestirse: de día es
todavía bastante cálido, pero por la mañana hace mucho frío. Muchísimo.
Entonces todos andan muy abrigados con muchas prendas quitándose sus sacos
uno por uno. Después del verano caliente, cinco grados centígrados se siente
como uno estuviera en el Polo norte. Pero ese es el precio que pagamos para
ver esa abundancia de colores: las hojas de los árboles pierden el pigmento
verde y el bosque se convierte en un lugar mágico. Siempre trataba de no
levantar mucho las piernas cuando andaba para hacer crujir las hojas cecas
de los árboles.</p>

<p>Luego, inesperadamente (como cada año), llega la nieve, y es inesperado
porque los servicios de aseo nunca están preparados. De verdad, nadie está
preparado. Creo que es porque todos tienen muy por dentro una pequeña esperanza
de que puede ser éste año el invierno no llegue. Los árboles se vuelven
completamente siniestros y se ven como muertos.</p>

<p><img class="center" src="/images/winter.jpg" title="'Mi colegio (de primaria) en Moscú en invierno'" ></p>

<p>El diciembre el mundo se queda sumido en la oscuridad. Lo más doloroso era
despertarse por la mañana para ir al colegio:</p>

<p>A las siete de la mañana suena el despertador, uno abre los ojos, pero todo
está completamente oscuro, como a la medianoche. Los ojos se cierran lentamente
y te vuelves a terminar de ver el último sueño. Pero luego llega el dolor –
alguien prendió la luz. La luz entra a través de los párpados cerrados, y es
insoportable. Uno trata de entreabrir los ojos, pero el brillo amarillo les ciega,
entonces uno tiene que cerrarlos inmediatamente. Así con los ojos medio abiertos
uno desayuna, se viste y sale de la casa a la oscuridad para patullar por la nieve.
Claro que el barrendero también tuvo pereza y lo había limpiado las calles,
entonces tocaba de nuevo abrir el camino hasta el colegio.</p>

<p><img class="center" src="/images/colegio.jpg" title="'Mi colegio (edificios del primer grado y la secundaria)'" ></p>

<p><img class="center" src="/images/colegio3.jpg" title="'Mi colegio (edificios del primer grado y la secundaria)'" ></p>

<p><img class="center" src="/images/colegio4.jpg" title="'Mi colegio (edificios del primer grado y la secundaria)'" ></p>

<p>Las imágenes tomadas de
<a href="https://ssl.panoramio.com/user/2301915">https://ssl.panoramio.com/user/2301915</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/29/somos-de-una-sangre-por-roman-super/">Somos de una sangre por Roman Super</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-29T14:10:22-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:10 pm</span></time>
        
           | <a href="/blog/2016/05/29/somos-de-una-sangre-por-roman-super/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/05/29/somos-de-una-sangre-por-roman-super/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>Somos de una sangre, tú y yo" - dijo Mowgli...</p><footer><strong>Rudyard Kipling</strong> <cite>El Libro De La Selva</cite></footer></blockquote>


<p><img class="center" src="/images/de_una_sangre.jpg" title="'Somos de una sangre'" ></p>

<p><a href="https://daily.afisha.ru/archive/gorod/people/esli-est-ad-na-zemle-eto-kashirka-roman-super-o-tom-kak-perezhit-rak-zheny/">La entrevista</a>
con Roman Super y la periodista Elena Vanina para
<a href="https://daily.afisha.ru/archive/gorod/people/esli-est-ad-na-zemle-eto-kashirka-roman-super-o-tom-kak-perezhit-rak-zheny/">la revista Afisha</a>.
Traducción a español:</p>

<p><strong><a href="https://www.goodreads.com/book/show/27394679">Tu libro</a> es no es sólo
una historia acerca de cómo tú y tu esposa Yulia vencieron el cáncer.
Es una historia de amor extraordinaria. Linda y asombrosa.</strong></p>

<p>Simplemente, es que yo siempre tuve suerte con las niñas.
Con mi mamá, que alguna vez también fue niña.
Con mis profesoras en el colegio y en la universidad,
quienes también fueron niñas e alguna época.
Y con mi esposa, quien era niña, cuando nos conocimos.</p>

<p><strong>¿Eso pasó hace mucho tiempo?</strong></p>

<p>Sí. Yo estudiaba en el colegio y tenía ganas de ingresar a la universidad y
asistía a los cursos para los postulantes, que daba una estudiante de la facultad de periodismo.
Yulia era amiga de esa muchacha y un día por casualidad entró al salón donde estaba yo.
Así nos conocimos. Después yo la quité a su novio, con quien iba a casarse.
Después yo mismo me volví su novio, luego el esposo, y más tarde el papá de nuestro niño.
Así fue.</p>

<p><strong>Ustedes eran jóvenes, estaban felices y hacía poco habían tenido un hijo.
Ustedes esperaban de la vida cualquier cosa, pero no eso.
Y de repente les cae un diagnóstico horroroso - el cáncer.
¿Recuerdas cómo fue eso?</strong></p>

<p>Me asusté mucho. Empecé a imaginar un funeral, un cementerio.
Empecé a imaginar cómo iba a criar a nuestro hijo solo y trabajar al mismo tiempo.
Por supuesto, en una situación como esa, lo primero que uno debe hacer es llamar
a la persona que pueda decirle qué hacer. En mi caso esa persona era Katya Gordeeva
(una autora la las películas documentales y del libro &ldquo;Superar el cancer&rdquo;),
quien es una experta en la materia. Nosotros hablamos,
y Katya me hizo aclarar mis pensamientos. Y eso ayudó.
Tú estás nervioso, preocupado, temes a todo. Y todos tus temores te distraen
de las cosas en las cuales tienes que concentrarte. Y tú tienes que entender,
que toda tu vida posterior va a convertirse en un trabajo poco agradable,
que va a sacar muchas fuerzas de ti. Tendrás que tranquilizarte constantemente.</p>

<p><strong>El miedo. En Rusia, perece, que para todos es un sinónimo de cáncer.
Una vez estaba caminando en Berlin y hacía mi corría un grupo de personas
enfermas con unas camisetas de colores vivos con la frase &ldquo;Vencemos el cáncer.&rdquo;
Ellos sonreían. Los vi y en ese momento de la forma automática miré al
otro lado: no-no, por supuesto, no tengo miedo, simplemente al otro lado
de la calle hay una cosa muy bonita. Se impone una sensación, de que esconderse
es un reflejo universal.</strong></p>

<p>Es un problema muy grande. Mi suegro es una persona muy enferma, y ante los ojos
de él su hija se enfermó, estaba en el hospital y se curó,
pero no sé qué tendría que pasar para que él vaya al hospital.
No importa si es por alguna cosa pequeña o por algo grave.
No sé cómo explicarlo de una forma racional. Y hay muchos ejemplos de ese estilo.
Pero todo debería ser diferente: te asustaste, entonces corre al doctor.
Probablemente, la gente que tiene recursos, debe difundir esa idea.
Yo escribía mi libro y pensaba, que era posible que en el futuro se pueda tomarlo como un manual.
Cuando viene una desgracia, tú no sabes qué hacer, a dónde ir, en qué pensar.
Es muy fácil volverse loco. Yo quería escribir acerca de eso.
¿Mi libro o el libro de Katya Gordeeva son capaces de cambiar algo al nivel estructural?
No lo creo. Pero si incluso mil de personas miran el problema de otra forma, será un éxito.</p>

<p><strong>Cuando yo vi a mis conocidos, cuyas parejas tenían cáncer, a veces me parecía
que la persona enferma se mantenía más firme comparando con sus familiares.
¿Es así en realidad?</strong></p>

<p>Sí, es verdad. Lo primero que uno quiere hacer es desanimarse, estancarse
y escapar del problema. Pero así llegaría el fin. Nada resultaría.
Yo vi cómo Yulia estaba bajo los cuentagotas, que la quemaban desde adentro,
la afectaban mucho físicamente. Durante esos seis sesiones de quimioterapia
ella se quejó o dio rienda suelta a sus emociones sólo una vez y media o dos veces.
Yo lo hacía con más frecuencia.</p>

<p><strong>¿Tu hijo fue alguna vez al hospital donde estaba tu esposa?</strong></p>

<p>Por supuesto que no. Yo vi unos niños por allá, pero me parece que no
es lugar para ellos. Luka era demasiado pequeño para explicarle que es oncología.
Él entendía, que la mamá estaba enferma, que en algún momento se volvió clava.
Pero tratábamos de volverlo una broma: &ldquo;ay, la mamá de volvió calva.
La mamá se enfermó y luego se recuperó.&rdquo;</p>

<p><strong>¿Era difícil quedarte solo con el hijo?</strong></p>

<p>El tratamiento de Yulia cayó en los meses de verano, entonces la gran parte
del tiempo Luka estaba en la dacha con sus abuelos. En este aspecto
tuvimos suerte. Por otro lado, yo ya tenía experiencia en estar con mi hijo
sin la mamá. Un tiempo antes la mamá de Yulia también tuvo cáncer.
Así somos de &ldquo;suertudos&rdquo;. Yulia era como la enfermera de su mamá,
y yo estaba con Luka. Entonces me acostumbré. Lo más difícil era actuar
frente el niño como si no hubiera pasado nada grave. Con la mitad de
tu cerebro tienes que pensar en los helados, la plazoleta de juegos,
diversiones y los dibujos animados. Y con la otra - que la mamá de este
niño cayó en desgracia. No es fácil, pero es lo que pone las cosas en su lugar.
Tú revaluaslas prioridades en tu vida. Después de que Yulia se enfermó,
no hemos peleado. Ni una sola vez. Y Luka resultó la fuente principal de
las fuerzas para nosotros. Nos dimos cuanta de que nos gustaría un día estar
en la fiesta de su matrimonio juntos, que queremos ayudarle a escapar
el servicio militar, que queremos mostrarle las películas que nos gustan
y recomendarle libros&hellip;</p>

<p><strong>¿Qué fue lo más difícil durante el tratamiento?</strong></p>

<p>Lo más duro empezó un año después del tratamiento. La radioterapia es como
un pequeño Chernobyl para una persona. Pasa un tiempo, y te empiezan a alcanzar
los efectos secundarios, de los cuales no te habían advertido. Se daña la tiroides,
dejas de poder controlar tu peso, no comes nada, pero igual te engordas,
o de repente te despiertas por la noche con la taquicardia, que normalmente
no le da a una persona. Y eso asusta mucho. Porque pensabas que ya te curaste,
que empezó una vida nueva, que todo lo malo ha quedado atrás.
Y de repente tienes esa tensión como el de un caballo.
El tratamiento del cáncer también incluye un periodo de la rehabilitación,
el cual en Rusia nadie se encarga. Te hemos curado el tumor y adiós.
Que pena. Y cómo vas a seguir viviendo es tu problema.</p>

<p><strong>Al mirar ese camino que ustedes han pasado juntos, ¿se puede decir que te enseño algo?</strong></p>

<p>La cuestión principal, como me parece, que tienes que preguntarte en
una situación así no es ¿por qué? Es ¿para qué?  Porque para la pregunta
¿por qué? no hay respuesta. Y sobre la pregunta ¿para qué? vale la pena reflexionar.
Acerca de eso escribí en mi libro. Después de la enfermedad trato de pasar
cada segundo libre con mi familia, simplemente siempre queremos estar juntos.
Antes no era así. Ésta visa es muy correcta. Ella da origen a muchos sensaciones
agradables, de las cuales nos estamos privando. Puede ser que para eso.</p>

<p><img class="center" src="/images/super_book.jpg" title="'Roman Super'" ></p>

<p>El libro de Roman Super en Bookmate:
<a href="https://bookmate.com/books/IRInDaCY">https://bookmate.com/books/IRInDaCY</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/26/como-obtener-el-nombre-del-dia-de-la-semana-en-python/">Cómo obtener el nombre del día de la semana en Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-26T09:02:36-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:02 am</span></time>
        
           | <a href="/blog/2016/05/26/como-obtener-el-nombre-del-dia-de-la-semana-en-python/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/05/26/como-obtener-el-nombre-del-dia-de-la-semana-en-python/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="kn">import</span> <span class="nn">calendar</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Monday&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Tuesday&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Wednesday&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Thursday&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Friday&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Saturday&#39;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Sunday&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si para nosotros la semana empieza el Domindo, podemos escribirlo de la siguiente forma:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="n">sunday</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="n">sunday</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">7</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Sunday&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="n">tuesday</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">calendar</span><span class="o">.</span><span class="n">day_name</span><span class="p">[</span><span class="n">tuesday</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">7</span><span class="p">]</span>
</span><span class='line'><span class="s">&#39;Tuesday&#39;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/18/espias-rusos/">Espías rusos</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-18T14:56:49-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:56 pm</span></time>
        
           | <a href="/blog/2016/05/18/espias-rusos/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/05/18/espias-rusos/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="center" src="/images/espias.jpg" title="'Espías rusos'" ></p>

<p>La pareja de los agentes de los servicios de inteligencia nacidos en Rusia –
<strong>Andrey Bezrukov</strong> y <strong>Elena Vavilova</strong> – llegaron a Canada para cumplir
su misión bajo los nombres de <strong>Donald Heathfield</strong> y <strong>Tracey Foley</strong>
<a href="https://en.wikipedia.org/wiki/Illegals_Program">[1]</a>, y empezaron a construir
su nueva vida. Posteriormente ellos tuvieron dos hijos:
<strong>Tim y Alex Foley</strong>, a quienes recientemente les entrevistó el periodista de
Guardian Shaun Walker <a href="http://www.theguardian.com/world/2016/may/07/discovered-our-parents-were-russian-spies-tim-alex-foley">[2]</a>.
Los muchachos le contaron acerca de su vida después de la revelación de sus padres
y su trauma psíquico: no era fácil de aceptar a los 20 años de edad que toda
la vida de ellos era una mentira…</p>

<p>En el año 2010 arrestaron a diez residentes de EEUU bajo la acusación de espionaje.
Su actividad se reveló a causa de la traición de uno de los empleados del
Servicio de Inteligencia Exterior de la Federación de Rusia
<a href="https://es.wikipedia.org/wiki/Servicio_de_Inteligencia_Extranjera">[3]</a>.
A Bezrukov y Vavilova les arrestaron en su casa en Cambridge
(en el estado de Massachusetts). Todo era como en una película:
un grupo armado irrumpió violentamente en casa con el grito “¡FBI!”,
agarraron a los espías y los llevaron dentro de unos carros negros.
A los niños les dijeron que tenían un cuarto de hotel reservado para ellos,
porque iban a efectuar un registro en la casa. Los policías llevaron absolutamente
todo, incluyendo las fotos y la consola de videojuegos. Todas las cuentas
bancarias de Donald y Tracey fueron bloqueadas, por eso los muchachos se quedaron
sólo con el efectivo que tenían en sus bolsillos en ese momento
<a href="https://slon.ru/posts/67822">[4]</a>.</p>

<p>Al principio, a los muchachos les parecía que todo eso era un error,
y que los viajes frecuentes de negocios de su padre hicieron desconfiar
a la policía. Pero resultó que no hubo ningún error y sus padres de verdad eran
unos espías rusos.</p>

<blockquote><p>Según Tim y Alex, ellos tenían una vida normal, incluso un poco aburrida…</p></blockquote>

<p>Tracey Foley dio a luz a su primer hijo Tim en 1990. Después de un año del
nacimiento de Alex la familia se mudó a Paris, donde un tiempo después Donald
obtuvo su MBA. Al volver de Europa, él entró a la Escuela de Gobierno
John F. Kennedy de la Universidad de Harvard, y empezó a trabajar en una consultaría.
Tracey era un ama de casa, pero cuando los niños crecieron, ella empezó a trabajar
como agente inmobiliario. Según Tim y Alex, ellos tenían una vida normal,
incluso un poco aburrida: en Boston, a donde su familia se mudó en 1999,
ellos iban al colegio, salían con sus papás a vacaciones y a veces recibían
regalos de sus abuelos de Canadá. Los muchachos vieron a sus abuelos sólo
una vez en su vida, pero cuando eran todavía muy pequeños. Probablemente por eso
ellos no se dieron cuenta de que los abuelos no sabían hablar inglés.
Las fotos con la nieve canadiense en el fondo, que les enviaron,
fueron hechos en Siberia, de donde en realidad era su padre.
En 2008 la familia recibió la ciudadanía estadounidense, pero Tim y Alex
siempre se sentían como ciudadanos canadienses y estaban orgullosos de su patria.</p>

<p>En el verano 2010, cuando arrestaron a sus papás, a los muchachos les dieron
pasaportes rusos y ellos tuvieron que irse a Moscú.
Tim se convirtió en Timoféy y Alex – en Alexander Vavilov. Como decía Tim,
se les dificultaba mucho pronunciar sus nuevos nombres.</p>

<iframe style="text: align-center;" width="560" height="315" src="https://www.youtube.com/embed/Lz0eQtTGh84" frameborder="0" allowfullscreen></iframe>


<p>Entrevista con Andrey Bezrukov publicada en la revista Experto
<a href="http://expert.ru/russian_reporter/2012/40/pochemu-shpionyi-pohozhi-na-uchenyih/">[5]</a>:</p>

<p><em>– Dicen que durante todo el tiempo de su servicio usted no dijo ni una palabra en ruso. ¿Es verdad?</em></p>

<p>– Sí, es verdad. Es la particularidad del trabajo ilegal. Tú no puedes hablar
tu lengua materna incluso en la casa, todo está bajo un autodominio.
Aunque después de unos años de trabajo eso se vuelve algo natural.
Incluso tienes sueños en otros idiomas.</p>

<p><em>– ¿Su esposa también trabajaba con usted?</em></p>

<p>– Sí, mi esposa Elena es una espía profesional y estuvimos trabajando
juntos hasta el último día.</p>

<p><em>– Dinero, el negocio, que hay que mantener – es toda una vida completa en el extranjero…</em></p>

<p>– Sí, por supuesto. En general , al verlo desde un punto de vista profesional,
cuando una persona se encuentra en el exterior en una situación como la mía,
se tiene que construir una nueva vida: resolver la situación económica y familiar.
Prácticamente, esa persona empieza su vida desde ceros. Se puede decir,
que te sientes como una persona diferente. Nosotros con mi esposa nos fuimos
a la comisión de servicio sólo con una maleta. Tuvimos que graduarnos de nuevo
de universidad, buscar trabajo, crear el negocio y no solo uno.
Y todo sin ninguna ayuda y con los recursos mínimos – tú entiendas
la situación en la que estaba nuestro país en esa época. Y a pesar de eso,
teníamos que cumplir nuestra misión – realizar el trabajo que nos dieron.</p>

<p><em>La imagen tomada de <a href="http://www.nytimes.com/2010/07/01/us/01cambridge.html?_r=0">nytimes.com</a></em></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/04/sql-to-sqlalquemy-conversions/">SQL to SQLAlquemy conversions</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-04T21:15:39-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:15 pm</span></time>
        
           | <a href="/blog/2016/05/04/sql-to-sqlalquemy-conversions/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/05/04/sql-to-sqlalquemy-conversions/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Some examples on how to convert raw SQL to SQLAlchemy query:</p>

<h3>Select all</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">text</span><span class="p">,</span> <span class="n">func</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Add labels</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">requiests</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s">&#39;requests&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">requests</span>
</span><span class='line'><span class="mi">12</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Sum</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="k">as</span> <span class="n">rides</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s">&#39;books&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">books</span>
</span><span class='line'><span class="mi">12</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Return a count of rows and distinct</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">author_id</span><span class="p">))</span> <span class="k">as</span> <span class="n">authors</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">distinct</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span class='line'>    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">distinct</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">author_id</span><span class="p">))</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s">&#39;authors&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Query a date range</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">b</span> <span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">created_at</span> <span class="o">&gt;</span> <span class="k">current_timestamp</span> <span class="o">-</span> <span class="p">(</span><span class="k">current_timestamp</span> <span class="o">-</span> <span class="nb">interval</span> <span class="s1">&#39;5 hours&#39;</span><span class="p">)::</span><span class="n">time</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Book</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">now</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Conditional sum</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(((</span><span class="n">status</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">))::</span><span class="nb">int</span><span class="p">))</span> <span class="k">as</span> <span class="n">books</span> <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="n">case</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span class='line'>    <span class="n">func</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">case</span><span class="p">([(</span><span class="n">Book</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">in_</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">else_</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s">&#39;books&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span class='line'>    <span class="c"># ...</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>In</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="n">Book</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Book</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">in_</span><span class="p">((</span>
</span><span class='line'>        <span class="n">BOOK_CONFIRMED</span><span class="p">,</span>
</span><span class='line'>        <span class="n">BOOK_FINISHED</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)),</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Other examples</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span><span class='line'><span class="n">six_months_ago</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">books</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span class='line'>    <span class="n">func</span><span class="o">.</span><span class="n">to_char</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s">&#39;MM&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Book</span><span class="o">.</span><span class="n">author_id</span> <span class="o">==</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>  <span class="c"># Filter books by author</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Book</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">six_months_ago_min</span><span class="p">,</span> <span class="n">today_max</span><span class="p">)</span>  <span class="c"># Get all books created in last six months</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span>
</span><span class='line'>    <span class="n">func</span><span class="o">.</span><span class="n">to_char</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s">&#39;MM&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">to_char</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span> <span class="s">&#39;MM&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/20/asya-kazantseva-la-utilidad-de-los-productos-organicos-es-un-mito-habitual/">Asya Kazantseva: “La utilidad de los productos orgánicos es un mito habitual”</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-20T21:08:04-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:08 pm</span></time>
        
           | <a href="/blog/2016/04/20/asya-kazantseva-la-utilidad-de-los-productos-organicos-es-un-mito-habitual/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2016/04/20/asya-kazantseva-la-utilidad-de-los-productos-organicos-es-un-mito-habitual/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="center" src="/images/asya.jpg" title="'Asya Kazantseva'" ></p>

<p><em>Asya Kazantseva es una periodista científica y divulgadora de ciencia.</em></p>

<p>Un comprador estadístico medio ruso está desinformado.
Él recela los productos geneticamente modificados y piensa que la comida
orgánica es es a priori saludable y segura para el medio ambiente,
a pesar de que no se confirman ni el daño, ni un beneficio significativo de
los productos orgánicos en ninguna investigación científica.
Durante toda la historia de la humanidad, no eramos muchos,
y la mayoría de la gente se ocupaba de la agricultura y sembraba
la comida para sí misma, y esto acababa con todas sus fuerzas y
habilidades creativos. La invención de los antibióticos y
la vacunación redujo la mortalidad infantil de la forma radical,
y durante los últimos cien años la población creció significativamente.
Eso significa, que ahora necesitamos métodos de intensificación de la agricultura,
que permitan plantar muchos alimentos con el mínimo de los recursos humanos
y naturales. El desarrollo de los abonos modernos y las plantas genéticamente
modificadas ayuda a reolver ese problema.</p>

<p>Muchas investigaciones demuestran que comida orgánica contiene más bacterias,
y en el caso de la carne, además, gusanos parásitos. Y no es algo extraño:
si usted no les da medicinas a los animales, y además les permite pasear
donde ellos quieran, y comer lo que deseen, ellos van a enfermarse de algo.
Si usted abona las plantas con estiércol, en ese estiércol incluso después
de un tiempo se conservan unos microorganismos interesantes.
En principio, para la prevención de las enfermedades intestinales,
es mejor someter la comida al tratamiento térmico o al menos lavarla
bien antes de consumirla. En mayoría de los casos los microorganismos
mueren en nuestros estómagos o se eliminan rápidamente con nuestro sistema
immune, pero a veces aparecen nuevas cepas frente a las cuales las personas
se encuentran indefensas. Así pasó en Alemania y Francia durante la
explosión de una <a href="https://es.wikipedia.org/wiki/Brote_del_s%C3%ADndrome_ur%C3%A9mico_hemol%C3%ADtico_de_2011#cite_note-3">infección intestinal en 2011</a>.
El agente microbífico era E. coli, que tomó de la otra bacteria del estiércol
un gen del toxin que provoca la disentería.  La investigación epidemiológica
demostró que la gente que se infectó en la nueva cepa de E. coli consumían
semillas de una finca orgánica en Egipcio. Según la OMS se enfermaron
4075 personas y murieron 50.</p>

<p>Enlaces:</p>

<ul>
<li>El libro de Asya Kazantseva <a href="https://play.google.com/store/books/details?id=1IiqCwAAQBAJ">“В интернете кто-то неправ! Научные исследования спорных вопросов”</a></li>
<li>[Entrevista con Asya Kazantseva](<a href="http://www.psychologies.ru/wellbeing/food/asya-kazantseva-polza-organicheskih-produktov-ocherednoy-mif/">http://www.psychologies.ru/wellbeing/food/asya-kazantseva-polza-organicheskih-produktov-ocherednoy-mif/</a></li>
</ul>


<p><em>Imagen tomada de: <a href="https://daily.afisha.ru/brain/533-moya-zadacha-ne-v-tom-chtoby-mne-poverili/">https://daily.afisha.ru/brain/533-moya-zadacha-ne-v-tom-chtoby-mne-poverili/</a></em></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/12/18/think-like-i-do/">Think like I do</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/18/libros-que-leen-los-ninos-rusos/">Libros que leen los niños rusos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/30/sistema-de-riego-por-capilaridad/">Sistema de riego por capilaridad</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/27/how-to-upload-a-file-to-amazon-s3-and-generate-a-pre-signed-url/">How to upload a file to Amazon S3 and generate a pre-signed URL</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/26/how-to-send-an-email-with-attachment-via-amazon-ses-in-python/">How to send an email with attachment via Amazon SES in Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/21/como-pasar-variable-desde-una-vista-a-formulario-en-django/">Cómo pasar variable desde una vista a formulario en Django</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/07/mierdero-de-las-semanas/">Mierdero de las semanas</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/08/herramienta-para-el-desarrollo-que-nos-hacen-la-vida-mas-facil/">Herramientas para el desarrollo que nos hacen la vida más fácil</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/04/las-series-que-marcaron-los-anos-noventa-en-rusia/">Las series que marcaron los años noventa en Rusia</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/31/multiples-bases-de-datos-en-django/">Múltiples bases de datos en Django</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Featured Posts</h1>
  <ul id="recent_posts">
    
    
      
        
        <li class="post">
          <a href="/blog/2016/12/18/think-like-i-do/">Think like I do</a>
        </li>
      
    
      
        
        <li class="post">
          <a href="/blog/2016/12/18/libros-que-leen-los-ninos-rusos/">Libros que leen los niños rusos</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
        <li class="post">
          <a href="/blog/2016/08/18/como-hacer-integracion-con-tpaga-api-usando-python/">Cómo hacer integración con Tpaga API usando Python</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </ul>
</section>
<a href="https://twitter.com/vero4ka_ru" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @vero4ka_ru</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><script src="//blockr.io/js_external/coinwidget/coin.js"></script>
        <script>
            CoinWidgetCom.go({
                wallet_address: '12Ep9CdebjLQpnQnim1k6cYT3Z8UPkEQxR',
                currency: 'bitcoin',
                counter: 'count',
                lbl_button: 'Donate',
                lbl_count: 'donations',
                lbl_amount: 'BTC',
                lbl_address: 'Use address below to donate. Thanks!',
                qrcode: true,
                alignment: 'bl',
                decimals: 8,
                size: "small",
                color: "dark",
                countdownFrom: "0",
                element: "#coinwidget-bitcoin-12Ep9CdebjLQpnQnim1k6cYT3Z8UPkEQxR",
                onShow: function(){},
                onHide: function(){}
            });
        </script>
        <div id="coinwidget-bitcoin-12Ep9CdebjLQpnQnim1k6cYT3Z8UPkEQxR"></div><section>
<!-- Show static HTML/CSS as a placeholder in case js is not enabled - javascript include will override this if things work -->
<h1>Goodreads</h1>
<style type="text/css" media="screen">
  .gr_custom_container_1425777029 {
    /* customize your Goodreads widget container here*/
    border: 1px solid gray;
    border-radius:10px;
    padding: 10px 5px 10px 5px;
    background-color: #FFFFFF;
    color: #000000
  }
  .gr_custom_header_1425777029 {
    /* customize your Goodreads header here*/
    border-bottom: 1px solid gray;
    width: 100%;
    margin-bottom: 5px;
    text-align: center;
    font-size: 120%
  }
  .gr_custom_each_container_1425777029 {
    /* customize each individual book container here */
    width: 100%;
    clear: both;
    margin-bottom: 10px;
    overflow: auto;
    padding-bottom: 4px;
    border-bottom: 1px solid #aaa;
  }
  .gr_custom_book_container_1425777029 {
    /* customize your book covers here */
    overflow: hidden;
    height: 60px;
      float: left;
      margin-right: 4px;
      width: 39px;
  }
  .gr_custom_author_1425777029 {
    /* customize your author names here */
    font-size: 10px;
  }
  .gr_custom_tags_1425777029 {
    /* customize your tags here */
    font-size: 10px;
    color: gray;
  }
  .gr_custom_rating_1425777029 {
    /* customize your rating stars here */
    float: right;
  }
</style>

      <div id="gr_custom_widget_1425777029">
          <div class="gr_custom_container_1425777029">
    <h2 class="gr_custom_header_1425777029">
    <a href="https://www.goodreads.com/review/list/3165514-vera?shelf=read&amp;utm_medium=api&amp;utm_source=custom_widget" style="text-decoration: none;">Vera's bookshelf: read</a>
    </h2>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1194506057?utm_medium=api&amp;utm_source=custom_widget" title="On the Road"><img alt="On the Road" border="0" src="https://d.gr-assets.com/books/1413588576s/70401.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="2 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_2_of_5.png" title="2 of 5 stars, it was ok" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1194506057?utm_medium=api&amp;utm_source=custom_widget">On the Road</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/1742.Jack_Kerouac">Jack Kerouac</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1135255906?utm_medium=api&amp;utm_source=custom_widget" title="The Call of the Wild"><img alt="The Call of the Wild" border="0" src="https://d.gr-assets.com/books/1412619130s/1852.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="4 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_4_of_5.png" title="4 of 5 stars, really liked it" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1135255906?utm_medium=api&amp;utm_source=custom_widget">The Call of the Wild</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/1240.Jack_London">Jack London</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1131823011?utm_medium=api&amp;utm_source=custom_widget" title="Murder on the Leviathan (Erast Fandorin Mysteries, #3)"><img alt="Murder on the Leviathan" border="0" src="https://d.gr-assets.com/books/1410658503s/64552.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="5 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_5_of_5.png" title="5 of 5 stars, it was amazing" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1131823011?utm_medium=api&amp;utm_source=custom_widget">Murder on the Leviathan</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/34589.Boris_Akunin">Boris Akunin</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1119579656?utm_medium=api&amp;utm_source=custom_widget" title="Roadside Picnic"><img alt="Roadside Picnic" border="0" src="https://d.gr-assets.com/books/1173812259s/331256.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="4 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_4_of_5.png" title="4 of 5 stars, really liked it" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1119579656?utm_medium=api&amp;utm_source=custom_widget">Roadside Picnic</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/1159886.Arkady_Strugatsky">Arkady Strugatsky</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1112654338?utm_medium=api&amp;utm_source=custom_widget" title="The Turkish Gambit (Erast Fandorin Mysteries, #2)"><img alt="The Turkish Gambit" border="0" src="https://d.gr-assets.com/books/1389073713s/97428.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="4 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_4_of_5.png" title="4 of 5 stars, really liked it" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1112654338?utm_medium=api&amp;utm_source=custom_widget">The Turkish Gambit</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/34589.Boris_Akunin">Boris Akunin</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1089110161?utm_medium=api&amp;utm_source=custom_widget" title="The Diary of a Young Girl"><img alt="The Diary of a Young Girl" border="0" src="https://d.gr-assets.com/books/1358276407s/48855.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="5 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_5_of_5.png" title="5 of 5 stars, it was amazing" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1089110161?utm_medium=api&amp;utm_source=custom_widget">The Diary of a Young Girl</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/3720.Anne_Frank">Anne Frank</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1088529875?utm_medium=api&amp;utm_source=custom_widget" title="Fathers and Sons"><img alt="Fathers and Sons" border="0" src="https://d.gr-assets.com/books/1390793535s/19117.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="5 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_5_of_5.png" title="5 of 5 stars, it was amazing" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1088529875?utm_medium=api&amp;utm_source=custom_widget">Fathers and Sons</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/410680.Ivan_Turgenev">Ivan Turgenev</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
  <br style="clear: both"/>
  <center>
    <a href="https://www.goodreads.com/"><img alt="goodreads.com" src="https://www.goodreads.com/images/widget/widget_logo.gif" style="border:0" /></a>
  </center>
  <noscript>
    Share <a href="https://www.goodreads.com/">book reviews</a> and ratings with Vera, and even join a <a href="https://www.goodreads.com/group">book club</a> on Goodreads.
  </noscript>
  </div>
      </div>
</section>
<script src="https://www.goodreads.com/review/custom_widget/3165514.Vera's%20bookshelf:%20read?cover_position=left&cover_size=small&num_books=7&order=d&shelf=read&show_author=1&show_cover=1&show_rating=1&show_review=1&show_tags=1&show_title=1&sort=date_added&widget_bg_color=FFFFFF&widget_bg_transparent=&widget_border_width=1&widget_id=1425777029&widget_text_color=000000&widget_title_size=medium&widget_width=medium" type="text/javascript" charset="utf-8"></script><section>
  <h1>Stats</h1>
  <a href="https://www.revolvermaps.com/?target=enlarge&amp;i=2m8hggs9gk4"><img
      src="//rc.revolvermaps.com/h/m/a/0/ff007e/128/15/2m8hggs9gk4.png"
      width="256" height="128" alt="Map" style="border:0; background-color: #93c7e0"></a>

  <a href="http://info.flagcounter.com/Nk91"><img src="http://s10.flagcounter.com/count2/Nk91/bg_ffffff/txt_9E9E9E/border_ffffff/columns_2/maxflags_50/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" border="0" alt="Flag Counter"></a>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - vero4ka -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - 
  <i>Image: <a href="https://unsplash.com/?photo=O85h02qZ24w">unsplash.com</a></i>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'vero4ka';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
