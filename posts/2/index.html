
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cansada de ser feliz</title>
  <meta name="author" content="vero4ka">

  
  <meta name="description" content="How to raise form invalid inside form_valid method of a FormView (CreateView/UpdateView) and add an error message to non_field_errors: from django. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.vero4ka.info/posts/2/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Cansada de ser feliz" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43471959-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Cansada de ser feliz</a></h1>
  
    <h2>tech notes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.vero4ka.info">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/comments">Contacts</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/how-to-raise-a-form-invalid-event-inside-form-valid-method-of-a-formview/">How to raise a form invalid event inside form_valid method of a FormView</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:35:52-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:35 pm</span></time>
        
           | <a href="/blog/2015/03/01/how-to-raise-a-form-invalid-event-inside-form-valid-method-of-a-formview/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/how-to-raise-a-form-invalid-event-inside-form-valid-method-of-a-formview/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How to raise form invalid inside <code>form_valid</code> method of a <code>FormView</code> (<code>CreateView</code>/<code>UpdateView</code>) and add an error message to <code>non_field_errors</code>:</p>

<div><script src='https://gist.github.com/3b62a13bdce7fe4178ac.js'></script>
<noscript><pre><code>from django.forms.util import ErrorList
from django import forms

class ContractUpdateView(UpdateView):
    model = Contract
    template_name = &#39;contract/contract_form.html&#39;
    form_class = ContractForm

    def form_valid(self, form):
        if self.request.POST.get(&#39;finish&#39;):
            if (
                not form.cleaned_data[&#39;number&#39;] or
                not self.object.images.count()
            ):
                form._errors[forms.forms.NON_FIELD_ERRORS] = ErrorList([
                    u&#39;You have to add images and a contract number&#39;
                ])
                return self.form_invalid(form)
            self.object.is_submitted = True
        self.object = form.save()
        return HttpResponseRedirect(self.get_success_url())</code></pre></noscript></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/how-to-show-a-booleanfield-of-a-modelform-as-radio-select-yes-slash-no-in-django/">How to show a BooleanField of a ModelForm as radio select (yes/no) in Django</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:26:52-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:26 pm</span></time>
        
           | <a href="/blog/2015/03/01/how-to-show-a-booleanfield-of-a-modelform-as-radio-select-yes-slash-no-in-django/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/how-to-show-a-booleanfield-of-a-modelform-as-radio-select-yes-slash-no-in-django/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let&rsquo;s suppose that we have a field <code>is_active</code> in our model. It is a boolean field, but in a template we want to show it as a radio select.</p>

<p>In this case we just need to add <code>choices</code> attribute for the model field and then change a widget of the corresponding form:</p>

<figure class='code'><figcaption><span>forms.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class='line'>        <span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span>
</span><span class='line'>        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&#39;is_active&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">RadioSelect</span>
</span><span class='line'>        <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>forms.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">STATE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>        <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="s">u&#39;Yes&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="s">u&#39;No&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
</span><span class='line'>        <span class="n">verbose_name</span><span class="o">=</span><span class="s">u&#39;Is it active?&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
</span><span class='line'>        <span class="n">choices</span><span class="o">=</span><span class="n">STATE_CHOICES</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>UPDATE:</p>

<p>For newer Django versions.</p>

<figure class='code'><figcaption><span>forms.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class='line'>    <span class="n">STATE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>        <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="s">u&#39;Yes&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="s">u&#39;No&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">is_active</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">TypedChoiceField</span><span class="p">(</span>
</span><span class='line'>        <span class="nb">coerce</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
</span><span class='line'>        <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;No&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Yes&#39;</span><span class="p">)),</span>
</span><span class='line'>        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">RadioSelect</span>
</span><span class='line'>    <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/how-to-send-request-to-ajax-view-in-django-tests/">How to send request to AJAX view in Django tests</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:23:37-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:23 pm</span></time>
        
           | <a href="/blog/2015/03/01/how-to-send-request-to-ajax-view-in-django-tests/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/how-to-send-request-to-ajax-view-in-django-tests/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you have a view that requires an AJAX request, in other words, checks if <code>request.is_ajax()</code>, here is a way you can write a unit test for this view:</p>

<div><script src='https://gist.github.com/dca59e325c9f7554d176.js'></script>
<noscript><pre><code>import json
from django.test import TestCase

class JSONViewTestCase(TestCase):

    def test_json_view(self):
        response = self.client.post(
            reverse(&#39;my_json_view&#39;),
            json.dumps({
                # your JSON
            }),
            &#39;json&#39;,
            HTTP_X_REQUESTED_WITH=&#39;XMLHttpRequest&#39;,
        )
        json_string = response.content
        response_data = json.loads(json_string)
        # do smth.</code></pre></noscript></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/como-concatenar-querysets-del-mismo-modelo-en-django/">¿Cómo concatenar querysets del mismo modelo en Django?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:21:21-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:21 pm</span></time>
        
           | <a href="/blog/2015/03/01/como-concatenar-querysets-del-mismo-modelo-en-django/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/como-concatenar-querysets-del-mismo-modelo-en-django/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Modo #1:</p>

<p>Podemos usar <code>itertools.chain</code> para  unir dos o más querysets:</p>

<pre><code>from itertools import chain
for item in chain(qs1, qs2, qs3):
    # ...
</code></pre>

<p>Modo #2:</p>

<p>Podemos usar el operador lógico <code>OR</code>:</p>

<pre><code>res = qs1 | qs2 | qs3
res = res.distinct()
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/get-an-array-of-checked-checkboxes-values-using-jquery/">Get an array of checked checkboxes values using jQuery</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:17:42-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:17 pm</span></time>
        
           | <a href="/blog/2015/03/01/get-an-array-of-checked-checkboxes-values-using-jquery/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/get-an-array-of-checked-checkboxes-values-using-jquery/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div><script src='https://gist.github.com/9772283.js'></script>
<noscript><pre><code>&lt;input type=&quot;checkbox&quot; value=&quot;UN&quot; name=&quot;airlines&quot; checked&gt;       
&lt;input type=&quot;checkbox&quot; value=&quot;IB&quot; name=&quot;airlines&quot;&gt;      
&lt;input type=&quot;checkbox&quot; value=&quot;SU&quot; name=&quot;airlines&quot; checked&gt;</code></pre></noscript></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/algunos-paquetes-utiles-para-django/">Algunos paquetes útiles para Django</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:16:24-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:16 pm</span></time>
        
           | <a href="/blog/2015/03/01/algunos-paquetes-utiles-para-django/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/algunos-paquetes-utiles-para-django/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4><a href="https://github.com/omab/python-social-auth">python-social-auth</a></h4>

<p>Autentificación de usuarios con los redes sociales en Django.</p>

<h4><a href="https://github.com/praekelt/django-recaptcha">django-recaptcha</a></h4>

<p>Integración de reCAPTCHA en los formularios de Django.</p>

<h4><a href="https://github.com/alex/django-taggit">django-taggit</a></h4>

<p>Campo para los modelos de Django para crear etiquetas.</p>

<h4><a href="https://github.com/sehmaschine/django-grappelli">django-grappelli</a></h4>

<p>Interface para el Administrador de Django.</p>

<h4><a href="https://github.com/jezdez/django-constance">django-constance</a></h4>

<p>Para cambiar algunas variables de configuración desde el Administrador de Django.</p>

<h4><a href="https://github.com/praekelt/django-recaptcha">django-recaptcha</a></h4>

<p>Usar <a href="https://www.google.com/recaptcha/">reCAPTCHA</a> de Google en los formularios de Django.</p>

<h4><a href="https://github.com/trentm/django-markdown-deux">django-markdown-deux</a></h4>

<p>Templatetags y filtros que permiten usar Markdown en las plantillas de Django.</p>

<h4><a href="https://github.com/django-debug-toolbar/django-debug-toolbar">django-debug-toolbar</a></h4>

<p>La herramienta que ayuda con la depuración del código en Django.
Instrucciones para instalar el módulo: <a href="http://www.ruben-arranz.es/blog/instalar-django-debug-toolbar/">http://www.ruben-arranz.es/blog/instalar-django-debug-toolbar/</a></p>

<h4><a href="https://github.com/paulocheque/django-dynamic-fixture">django-dynamic-fixture</a></h4>

<p>Ayuda crear objetos de modelos de Django de la forma dinámica. Es muy útil para los test cuando hay necesidad de crear muchos objetos.</p>

<h4><a href="https://github.com/brack3t/django-braces">django-braces</a></h4>

<p>La biblioteca de los mixins útiles para Django.</p>

<h4><a href="https://github.com/revsys/django-friendship">django-friendship</a></h4>

<p>Biblioteca que ayuda a manejar las peticiones de amistad para los usuarios.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/django-templates-render-an-array-in-two-columns-using-bootstrap-grid/">Django templates: render an array in two columns using Bootstrap grid</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T19:03:05-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>7:03 pm</span></time>
        
           | <a href="/blog/2015/03/01/django-templates-render-an-array-in-two-columns-using-bootstrap-grid/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/django-templates-render-an-array-in-two-columns-using-bootstrap-grid/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div><script src='https://gist.github.com/efd0fdb46ef34971bac2.js'></script>
<noscript><pre><code>&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        1
    &lt;/div&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        2
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        3
    &lt;/div&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        4
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        5
    &lt;/div&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        6
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        7
    &lt;/div&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        8
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;info-block col-xs-12 col-sm-6&quot;&gt;
        9
    &lt;/div&gt;
&lt;/div&gt;</code></pre></noscript></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/how-to-validate-a-django-form-with-inline-formsets/">How to validate a Django form with inline formsets</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T18:57:47-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>6:57 pm</span></time>
        
           | <a href="/blog/2015/03/01/how-to-validate-a-django-form-with-inline-formsets/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/how-to-validate-a-django-form-with-inline-formsets/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div><script src='https://gist.github.com/1c065cb54baef2da79c2.js'></script>
<noscript><pre><code>from django.contrib import admin

from product.forms import EquipmentForm

@admin.register(Equipment)
class EquipmentAdmin(admin.ModelAdmin):
    form = EquipmentForm
    
    inlines = [
        EquipmentGalleryInline,
    ]</code></pre></noscript></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/generate-zip-file-in-django/">Generate .zip file in Django</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T18:47:58-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>6:47 pm</span></time>
        
           | <a href="/blog/2015/03/01/generate-zip-file-in-django/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/generate-zip-file-in-django/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A view that creates a .ZIP file of multiple files and returns it in response:</p>

<div><script src='https://gist.github.com/3b1768a1cb13f7e457d4.js'></script>
<noscript><pre><code>import os
import zipfile
import cStringIO as StringIO

class ContractDownloadGalleryDetailView(LoginRequiredMixin, DetailView):
    model = Contract

    def render_to_response(self, context, **httpresponse_kwargs):
        contract = self.object

        if not contract.images.exists():
            return HttpResponseRedirect(
                reverse(&#39;contract:contract_detail&#39;, args=(contract.id,)),
            )

        dirname = u&#39;imagenes_contrato_{0}&#39;.format(contract.number)
        filename = u&#39;{0}.zip&#39;.format(dirname)

        buffer = StringIO.StringIO()
        z = zipfile.ZipFile(buffer, &#39;w&#39;)
        for contract_image in contract.images.all():
            z.write(contract_image.image.path, os.path.join(dirname, os.path.basename(contract_image.image.path)))
        z.close()
        buffer.seek(0)
        response = HttpResponse(buffer.read())
        response[&#39;Content-Disposition&#39;] = u&#39;attachment; filename={0}&#39;.format(filename)
        response[&#39;Content-Type&#39;] = &#39;application/x-zip&#39;
        return response</code></pre></noscript></div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/01/django-python-social-auth-configuration-and-pipeline-to-get-users-information/">Django: python-social-auth configuration and pipeline to get users information</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-01T18:45:21-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>6:45 pm</span></time>
        
           | <a href="/blog/2015/03/01/django-python-social-auth-configuration-and-pipeline-to-get-users-information/#disqus_thread"
             data-disqus-identifier="http://blog.vero4ka.info/blog/2015/03/01/django-python-social-auth-configuration-and-pipeline-to-get-users-information/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><code>python-social-auth</code> configuration and pipeline to get users email, full name and save avatar for Facebook, Twitter, LinkedIn and Google in Django.</p>

<div><script src='https://gist.github.com/9899590.js'></script>
<noscript><pre><code>def update_user_social_data(strategy, *args, **kwargs):
    &quot;&quot;&quot;Set the name and avatar for a user only if is new.
    &quot;&quot;&quot;
    print &#39;update_user_social_data ::&#39;, strategy
    if not kwargs[&#39;is_new&#39;]:
        return

    full_name = &#39;&#39;
    backend = kwargs[&#39;backend&#39;]

    user = kwargs[&#39;user&#39;]

    if (
        isinstance(backend, GoogleOAuth2)
        or isinstance(backend, FacebookOAuth2)
    ):
        full_name = kwargs[&#39;response&#39;].get(&#39;name&#39;)
    elif (
        isinstance(backend, LinkedinOAuth)
        or isinstance(backend, TwitterOAuth)
    ):
        if kwargs.get(&#39;details&#39;):
            full_name = kwargs[&#39;details&#39;].get(&#39;fullname&#39;)

    user.full_name = full_name

    if isinstance(backend, GoogleOAuth2):
        if response.get(&#39;image&#39;) and response[&#39;image&#39;].get(&#39;url&#39;):
            url = response[&#39;image&#39;].get(&#39;url&#39;)
            ext = url.split(&#39;.&#39;)[-1]
            user.avatar.save(
               &#39;{0}.{1}&#39;.format(&#39;avatar&#39;, ext),
               ContentFile(urllib2.urlopen(url).read()),
               save=False
            )
    elif isinstance(backend, FacebookOAuth2):
        fbuid = kwargs[&#39;response&#39;][&#39;id&#39;]
        image_name = &#39;fb_avatar_%s.jpg&#39; % fbuid
        image_url = &#39;http://graph.facebook.com/%s/picture?type=large&#39; % fbuid
        image_stream = urlopen(image_url)

        user.avatar.save(
            image_name,
            ContentFile(image_stream.read()),
        )
    elif isinstance(backend, TwitterOAuth):
        if kwargs[&#39;response&#39;].get(&#39;profile_image_url&#39;):
            image_name = &#39;tw_avatar_%s.jpg&#39; % full_name
            image_url = kwargs[&#39;response&#39;].get[&#39;profile_image_url&#39;]
            image_stream = urlopen(image_url)

            user.avatar.save(
                image_name,
                ContentFile(image_stream.read()),
            )
    elif isinstance(backend, LinkedinOAuth):
        if kwargs[&#39;response&#39;].get(&#39;pictureUrl&#39;):
            image_name = &#39;linked_avatar_%s.jpg&#39; % full_name
            image_url = kwargs[&#39;response&#39;].get[&#39;pictureUrl&#39;]
            image_stream = urlopen(image_url)

            user.avatar.save(
                image_name,
                ContentFile(image_stream.read()),
            )
    user.save()</code></pre></noscript></div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/10/07/mierdero-de-las-semanas/">Mierdero de las semanas</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/09/08/herramienta-para-el-desarrollo-que-nos-hacen-la-vida-mas-facil/">Herramientas para el desarrollo que nos hacen la vida más fácil</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/31/multiples-bases-de-datos-en-django/">Múltiples bases de datos en Django</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/18/como-hacer-integracion-con-tpaga-api-usando-python/">Cómo hacer integración con Tpaga API usando Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/22/monitoreo-de-acciones-de-usuarios-en-flask-sqlalchemy/">Monitoreo de acciones de usuarios en Flask (SQLAlchemy)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/22/flask-for-django-developers/">Flask for Django developers</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/26/como-obtener-el-nombre-del-dia-de-la-semana-en-python/">Cómo obtener el nombre del día de la semana en Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/04/sql-to-sqlalquemy-conversions/">SQL to SQLAlquemy conversions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/30/pruebas-para-formularios-en-django/">Pruebas para formularios en Django</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/29/como-configurar-pycharm-para-compilar-los-archivos-sass/">Cómo configurar PyCharm para compilar los archivos SASS</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/vero4karu">@vero4karu</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'vero4karu',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<a href="https://twitter.com/vero4ka_ru" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @vero4ka_ru</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script><script src="//blockr.io/js_external/coinwidget/coin.js"></script>
        <script>
            CoinWidgetCom.go({
                wallet_address: '12Ep9CdebjLQpnQnim1k6cYT3Z8UPkEQxR',
                currency: 'bitcoin',
                counter: 'count',
                lbl_button: 'Donate',
                lbl_count: 'donations',
                lbl_amount: 'BTC',
                lbl_address: 'Use address below to donate. Thanks!',
                qrcode: true,
                alignment: 'bl',
                decimals: 8,
                size: "small",
                color: "dark",
                countdownFrom: "0",
                element: "#coinwidget-bitcoin-12Ep9CdebjLQpnQnim1k6cYT3Z8UPkEQxR",
                onShow: function(){},
                onHide: function(){}
            });
        </script>
        <div id="coinwidget-bitcoin-12Ep9CdebjLQpnQnim1k6cYT3Z8UPkEQxR"></div><section>
<!-- Show static HTML/CSS as a placeholder in case js is not enabled - javascript include will override this if things work -->
<h1>Goodreads</h1>
<style type="text/css" media="screen">
  .gr_custom_container_1425777029 {
    /* customize your Goodreads widget container here*/
    border: 1px solid gray;
    border-radius:10px;
    padding: 10px 5px 10px 5px;
    background-color: #FFFFFF;
    color: #000000
  }
  .gr_custom_header_1425777029 {
    /* customize your Goodreads header here*/
    border-bottom: 1px solid gray;
    width: 100%;
    margin-bottom: 5px;
    text-align: center;
    font-size: 120%
  }
  .gr_custom_each_container_1425777029 {
    /* customize each individual book container here */
    width: 100%;
    clear: both;
    margin-bottom: 10px;
    overflow: auto;
    padding-bottom: 4px;
    border-bottom: 1px solid #aaa;
  }
  .gr_custom_book_container_1425777029 {
    /* customize your book covers here */
    overflow: hidden;
    height: 60px;
      float: left;
      margin-right: 4px;
      width: 39px;
  }
  .gr_custom_author_1425777029 {
    /* customize your author names here */
    font-size: 10px;
  }
  .gr_custom_tags_1425777029 {
    /* customize your tags here */
    font-size: 10px;
    color: gray;
  }
  .gr_custom_rating_1425777029 {
    /* customize your rating stars here */
    float: right;
  }
</style>

      <div id="gr_custom_widget_1425777029">
          <div class="gr_custom_container_1425777029">
    <h2 class="gr_custom_header_1425777029">
    <a href="https://www.goodreads.com/review/list/3165514-vera?shelf=read&amp;utm_medium=api&amp;utm_source=custom_widget" style="text-decoration: none;">Vera's bookshelf: read</a>
    </h2>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1194506057?utm_medium=api&amp;utm_source=custom_widget" title="On the Road"><img alt="On the Road" border="0" src="https://d.gr-assets.com/books/1413588576s/70401.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="2 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_2_of_5.png" title="2 of 5 stars, it was ok" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1194506057?utm_medium=api&amp;utm_source=custom_widget">On the Road</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/1742.Jack_Kerouac">Jack Kerouac</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1135255906?utm_medium=api&amp;utm_source=custom_widget" title="The Call of the Wild"><img alt="The Call of the Wild" border="0" src="https://d.gr-assets.com/books/1412619130s/1852.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="4 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_4_of_5.png" title="4 of 5 stars, really liked it" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1135255906?utm_medium=api&amp;utm_source=custom_widget">The Call of the Wild</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/1240.Jack_London">Jack London</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1131823011?utm_medium=api&amp;utm_source=custom_widget" title="Murder on the Leviathan (Erast Fandorin Mysteries, #3)"><img alt="Murder on the Leviathan" border="0" src="https://d.gr-assets.com/books/1410658503s/64552.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="5 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_5_of_5.png" title="5 of 5 stars, it was amazing" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1131823011?utm_medium=api&amp;utm_source=custom_widget">Murder on the Leviathan</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/34589.Boris_Akunin">Boris Akunin</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1119579656?utm_medium=api&amp;utm_source=custom_widget" title="Roadside Picnic"><img alt="Roadside Picnic" border="0" src="https://d.gr-assets.com/books/1173812259s/331256.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="4 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_4_of_5.png" title="4 of 5 stars, really liked it" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1119579656?utm_medium=api&amp;utm_source=custom_widget">Roadside Picnic</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/1159886.Arkady_Strugatsky">Arkady Strugatsky</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1112654338?utm_medium=api&amp;utm_source=custom_widget" title="The Turkish Gambit (Erast Fandorin Mysteries, #2)"><img alt="The Turkish Gambit" border="0" src="https://d.gr-assets.com/books/1389073713s/97428.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="4 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_4_of_5.png" title="4 of 5 stars, really liked it" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1112654338?utm_medium=api&amp;utm_source=custom_widget">The Turkish Gambit</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/34589.Boris_Akunin">Boris Akunin</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1089110161?utm_medium=api&amp;utm_source=custom_widget" title="The Diary of a Young Girl"><img alt="The Diary of a Young Girl" border="0" src="https://d.gr-assets.com/books/1358276407s/48855.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="5 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_5_of_5.png" title="5 of 5 stars, it was amazing" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1089110161?utm_medium=api&amp;utm_source=custom_widget">The Diary of a Young Girl</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/3720.Anne_Frank">Anne Frank</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
      <div class="gr_custom_each_container_1425777029">
          <div class="gr_custom_book_container_1425777029">
            <a href="https://www.goodreads.com/review/show/1088529875?utm_medium=api&amp;utm_source=custom_widget" title="Fathers and Sons"><img alt="Fathers and Sons" border="0" src="https://d.gr-assets.com/books/1390793535s/19117.jpg" /></a>
          </div>
          <div class="gr_custom_rating_1425777029">
            <img alt="5 of 5 stars" class=" staticStars" src="https://www.goodreads.com/images/layout/stars/red_star_5_of_5.png" title="5 of 5 stars, it was amazing" />
          </div>
          <div class="gr_custom_title_1425777029">
            <a href="https://www.goodreads.com/review/show/1088529875?utm_medium=api&amp;utm_source=custom_widget">Fathers and Sons</a>
          </div>
          <div class="gr_custom_author_1425777029">
            by <a href="https://www.goodreads.com/author/show/410680.Ivan_Turgenev">Ivan Turgenev</a>
          </div>
          <div class="gr_custom_review_1425777029">
            
          </div>
      </div>
  <br style="clear: both"/>
  <center>
    <a href="https://www.goodreads.com/"><img alt="goodreads.com" src="https://www.goodreads.com/images/widget/widget_logo.gif" style="border:0" /></a>
  </center>
  <noscript>
    Share <a href="https://www.goodreads.com/">book reviews</a> and ratings with Vera, and even join a <a href="https://www.goodreads.com/group">book club</a> on Goodreads.
  </noscript>
  </div>
      </div>
</section>
<script src="https://www.goodreads.com/review/custom_widget/3165514.Vera's%20bookshelf:%20read?cover_position=left&cover_size=small&num_books=7&order=d&shelf=read&show_author=1&show_cover=1&show_rating=1&show_review=1&show_tags=1&show_title=1&sort=date_added&widget_bg_color=FFFFFF&widget_bg_transparent=&widget_border_width=1&widget_id=1425777029&widget_text_color=000000&widget_title_size=medium&widget_width=medium" type="text/javascript" charset="utf-8"></script>
<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+VeraMazhuga?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - vero4ka -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - 
  <i>Image: <a href="https://unsplash.com/?photo=O85h02qZ24w">unsplash.com</a></i>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'vero4ka';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
